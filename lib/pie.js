// Generated by CoffeeScript 1.10.0
var PieChart, React, d3,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

React = require('react');

d3 = require('d3');

module.exports = PieChart = (function(superClass) {
  extend(PieChart, superClass);

  function PieChart() {
    return PieChart.__super__.constructor.apply(this, arguments);
  }

  PieChart.prototype.render = function() {
    var arc, arcs, color, data, height, hover, inner_radius, onClick, onHover, pie, radius, ref, selected, width;
    ref = this.props, width = ref.width, height = ref.height, data = ref.data, onClick = ref.onClick, onHover = ref.onHover, selected = ref.selected, hover = ref.hover, inner_radius = ref.inner_radius;
    inner_radius || (inner_radius = 0);
    radius = Math.min(width, height) / 2;
    color = d3.scaleOrdinal(d3.schemeCategory20);
    pie = d3.pie().value(function(d) {
      return d.count;
    }).sort(null);
    if (this.props.start_angle) {
      pie = pie.startAngle(this.props.start_angle);
    }
    if (this.props.end_angle) {
      pie = pie.endAngle(this.props.end_angle);
    }
    arc = d3.arc().outerRadius(radius).innerRadius(inner_radius);
    arcs = pie(data).map(arc);
    return React.createElement("svg", {
      "className": 'pie-chart',
      "style": {
        position: 'relative',
        width: width,
        height: height
      }
    }, React.createElement("g", {
      "transform": "translate(" + radius + ", " + radius + ")"
    }, arcs.map((function(_this) {
      return function(arc, di) {
        var className, d;
        d = data[di];
        className = '';
        if (selected === d.label) {
          className += ' selected';
        } else if (hover === d.label) {
          className += ' hover';
        }
        return React.createElement("path", {
          "className": className,
          "onClick": onClick != null ? onClick.bind(null, d) : void 0,
          "onMouseOver": onHover != null ? onHover.bind(null, d) : void 0,
          "onMouseOut": onHover,
          "key": di,
          "x": radius,
          "y": radius,
          "d": arc,
          "fill": d.color || color(di)
        });
      };
    })(this))));
  };

  return PieChart;

})(React.Component);
